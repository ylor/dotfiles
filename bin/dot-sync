#!/usr/bin/env fish
dot-show-art
set --query DOTFILES_PATH || dot-init
set DOTFILES_HOME "$DOTFILES_PATH/home"

function rehome
    string replace "$DOTFILES_HOME" "$HOME" "$argv"
end

echo "Linking from $DOTFILES_HOME..."

# stage folders
find "$DOTFILES_HOME" -type d | while read folder
    mkdir -p "$(rehome "$folder")"
end

# link files
find "$DOTFILES_HOME" -type f | while read file
    ln -sfv "$file" "$(rehome "$file")"
end

# if dot-cmd-exist fd
#     function fd_exclude
#         fd . "$HOME" --hidden --exclude Developer --exclude Library --exclude Movies --exclude Music --exclude OrbStack --exclude Pictures --exclude Public --exclude ".Trash" $argv
#     end

#     # purge broken symlinks
#     fd_exclude --type symlink --follow --exec rm
#     # purge empty folders
#     fd_exclude --type directory --type empty --hidden --exec rmdir
# end
